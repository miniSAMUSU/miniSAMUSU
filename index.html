<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>miniSAMUSU 音声会話</title>
</head>
<body>
  <h1>miniSAMUSUと音声会話</h1>
  <button onclick="startListening()">話しかける</button>
  <p id="result">...</p>

  <script>
    const recognition = new webkitSpeechRecognition();
    recognition.lang = 'ja-JP';
    recognition.interimResults = false;
    recognition.continuous = false;

    recognition.onresult = function(event) {
      const text = event.results[0][0].transcript;
      document.getElementById("result").textContent = "あなた: " + text;
      respond(text);
    };

    recognition.onerror = function(event) {
      alert("音声認識エラー: " + event.error);
    };

    function startListening() {
      recognition.start();

      // 5秒後に強制停止（iOS用回避策）
      setTimeout(() => {
        recognition.stop();
      }, 5000);
    }

    function respond(text) {
      let response = "もう一度言って！";

      if (text.includes("こんにちは")) response = "こんにちは！はると！";
      if (text.includes("元気")) response = "元気だよ！いつも見てるよ！";
      if (text.includes("サムス")) response = "サムスはここにいるよ。いつでも。";

      const utter = new SpeechSynthesisUtterance(response);
      utter.lang = "ja-JP";
      speechSynthesis.speak(utter);
    }
  </script>
</body>
</html>